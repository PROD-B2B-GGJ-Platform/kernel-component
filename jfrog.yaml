version: 10.0.0.1
component: kernel-component
cluster: kernel-cluster

artifact:
  type: docker
  registry: ghcr.io
  repository: prod-b2b-ggj-platform
  imageName: kernel-component

variants:
  - name: dev
    tag: 10.0.0.1-dev-SNAPSHOT
    environment: development
    kubernetes:
      namespace: kernel-cluster-dev
      replicas: 2
    
  - name: uat
    tag: 10.0.0.1-uat-SNAPSHOT
    environment: uat
    kubernetes:
      namespace: kernel-cluster-uat
      replicas: 3
    
  - name: pre-prod
    tag: 10.0.0.1-pre-prod
    environment: pre-production
    kubernetes:
      namespace: kernel-cluster-preprod
      replicas: 5
    
  - name: prod
    tag: 10.0.0.1
    environment: production
    kubernetes:
      namespace: kernel-cluster-prod
      replicas: 10

build:
  dockerfile: ./docker/Dockerfile
  context: .
  args:
    - JAR_FILE=target/kernel-component.jar
    - JAVA_VERSION=17
  platforms:
    - linux/amd64
    - linux/arm64

maven:
  goals:
    - clean
    - package
    - -DskipTests
  settings: settings.xml

docker:
  buildArgs:
    - BUILD_DATE=${BUILD_DATE}
    - VCS_REF=${GIT_COMMIT}
    - VERSION=${VERSION}
  labels:
    - maintainer=b2b-platform-team@gograbjob.com
    - version=${VERSION}
    - component=kernel-component
    - cluster=kernel-cluster

jfrog:
  artifactory:
    url: https://prod-b2b-ggj.jfrog.io/artifactory
    repository: docker-local
    properties:
      - component=kernel-component
      - cluster=kernel-cluster
      - version=10.0.0.1
      - sprint=1
      - quarter=Q4-2025
  
  buildInfo:
    name: kernel-component
    number: ${BUILD_NUMBER}
    started: ${BUILD_TIMESTAMP}
    
  promotion:
    dev-to-uat:
      targetRepo: docker-uat
      status: staged
      comment: Promoting to UAT after dev testing
    
    uat-to-preprod:
      targetRepo: docker-preprod
      status: staged
      comment: Promoting to Pre-Prod after UAT validation
    
    preprod-to-prod:
      targetRepo: docker-prod
      status: release-ready
      comment: Promoting to Production after final validation

dependencies:
  - name: postgres
    version: "15.0+"
    required: true
  - name: redis
    version: "7.0+"
    required: true
  - name: kafka
    version: "3.5+"
    required: true

healthcheck:
  endpoint: /actuator/health
  interval: 30s
  timeout: 10s
  retries: 3

ports:
  - containerPort: 8083
    protocol: TCP
    name: http

resources:
  dev:
    requests:
      cpu: "1000m"
      memory: "1Gi"
    limits:
      cpu: "2000m"
      memory: "2Gi"
  
  uat:
    requests:
      cpu: "2000m"
      memory: "2Gi"
    limits:
      cpu: "4000m"
      memory: "4Gi"
  
  prod:
    requests:
      cpu: "4000m"
      memory: "4Gi"
    limits:
      cpu: "8000m"
      memory: "8Gi"

